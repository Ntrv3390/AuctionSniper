<ion-header [translucent]="true">
  <ion-toolbar class="custom-header">
    <ion-buttons slot="start">
      <ion-back-button color="light" defaultHref="/root/more"></ion-back-button>
    </ion-buttons>
    <ion-title mode="md">Account Information</ion-title>
    <ion-buttons slot="end">
      <ion-button
        color="light"
        *ngIf="!showError && !isSaving"
        (click)="save()"
      >
        <ion-icon name="checkmark-circle-outline" slot="start"></ion-icon>
        Save
      </ion-button>
      <ion-button *ngIf="isSaving" color="light" disabled>
        <ion-spinner name="crescent" slot="start"></ion-spinner>
        Saving
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="account-information-content">
  <!-- Error State -->
  <div class="error-container" *ngIf="showError">
    <div class="error-content">
      <ion-icon name="cloud-offline-outline" class="error-icon"></ion-icon>
      <h2>Connection Error</h2>
      <p>
        Unable to load your account information. Please check your connection
        and try again.
      </p>
      <ion-button expand="block" fill="solid" color="primary" (click)="retry()">
        <ion-icon name="refresh-outline" slot="start"></ion-icon>
        Try Again
      </ion-button>
    </div>
  </div>

  <!-- Loading State -->
  <div
    class="loading-container"
    *ngIf="!showError && !accountInfo?.UserID && !isSaving"
  >
    <ion-spinner name="crescent"></ion-spinner>
    <p>Loading your account information...</p>
  </div>

  <!-- Main Content -->
  <ng-container *ngIf="!showError && accountInfo?.UserID">
    <div class="page-header">
      <div class="header-icon">
        <ion-icon name="person-outline"></ion-icon>
      </div>
      <h1>{{ accountInfo.FirstName }} {{ accountInfo.LastName }}</h1>
      <p class="username">@{{ accountInfo.UserID }}</p>
    </div>

    <ion-list class="form-section">
      <ion-item-divider>
        <ion-label>Account Details</ion-label>
      </ion-item-divider>

      <ion-item
        (click)="showUsernameInfo()"
        class="readonly-item username-item"
      >
        <ion-label>
          <p class="username-label">Username</p>
          <h2 class="username-value">@{{ accountInfo.UserID }}</h2>
        </ion-label>
      </ion-item>

      <ion-item>
        <ion-label position="stacked">Email Address</ion-label>
        <ion-input
          type="email"
          placeholder="Email Address"
          [(ngModel)]="accountInfo.Email"
          name="email"
        >
        </ion-input>
      </ion-item>
    </ion-list>

    <ion-list class="form-section">
      <ion-item-divider>
        <ion-label>Contact Information</ion-label>
      </ion-item-divider>
      <ion-item>
        <ion-label position="stacked">First Name</ion-label>
        <ion-input
          type="text"
          placeholder="First Name"
          [(ngModel)]="accountInfo.FirstName"
          name="firstName"
        >
        </ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="stacked">Last Name</ion-label>
        <ion-input
          type="text"
          placeholder="Last Name"
          [(ngModel)]="accountInfo.LastName"
          name="lastName"
        >
        </ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="stacked">Address Line 1</ion-label>
        <ion-input
          type="text"
          placeholder="Street Address"
          [(ngModel)]="accountInfo.Address1"
          name="address1"
        >
        </ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="stacked">Address Line 2</ion-label>
        <ion-input
          type="text"
          placeholder="Apartment, suite, etc. (optional)"
          [(ngModel)]="accountInfo.Address2"
          name="address2"
        >
        </ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="stacked">City</ion-label>
        <ion-input
          type="text"
          placeholder="City"
          [(ngModel)]="accountInfo.City"
          name="city"
        >
        </ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="stacked">State/Province</ion-label>
        <ion-input
          type="text"
          placeholder="State/Province"
          [(ngModel)]="accountInfo.State"
          name="state"
        >
        </ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="stacked">Zip Code</ion-label>
        <ion-input
          type="text"
          placeholder="Postal Code"
          [(ngModel)]="accountInfo.Zip"
          name="zip"
        >
        </ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="stacked">Country</ion-label>
        <ion-select
          [(ngModel)]="accountInfo.CountryID"
          name="countryID"
          placeholder="Select Country"
        >
          <ion-select-option
            *ngFor="let country of countries"
            [value]="country.key"
          >
            {{ country.value }}
          </ion-select-option>
        </ion-select>
      </ion-item>
    </ion-list>

    <div class="actions-footer">
      <ion-button
        expand="block"
        fill="solid"
        (click)="save()"
        [disabled]="isSaving"
      >
        <ion-icon name="save-outline" slot="start"></ion-icon>
        Save Changes
      </ion-button>
    </div>
  </ng-container>

  <!-- Saving Overlay -->
  <div class="saving-overlay" *ngIf="isSaving">
    <div class="saving-content">
      <ion-spinner name="crescent"></ion-spinner>
      <p>Saving your changes...</p>
    </div>
  </div>
</ion-content>
