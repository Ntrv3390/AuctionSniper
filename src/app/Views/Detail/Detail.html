<ion-header>
  <ion-toolbar class="custom-header">
    <ion-buttons slot="start">
      <ion-back-button color="light" defaultHref="/root/more"></ion-back-button>
    </ion-buttons>
    <ion-title mode="md">Item Details</ion-title>
    <ion-buttons slot="end">
      <ion-button fill="clear" (click)="viewOnEbay_click()">
        <ion-icon name="open-outline" color="light"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="detail-content">
  <!-- ================= LOADING ================= -->
  <div class="loading-state" *ngIf="viewModel.showSpinner">
    <ion-spinner name="crescent" color="primary"></ion-spinner>
    <p>Loading item details...</p>
  </div>

  <!-- ================= ERROR ================= -->
  <div class="error-state" *ngIf="!viewModel.showSpinner && isError">
    <ion-card class="error-card">
      <ion-card-content>
        <ion-icon
          name="cloud-offline-outline"
          color="danger"
          class="error-icon"
        ></ion-icon>

        <h3>Error</h3>

        <p>{{ apiError || 'Something went wrong. Please try again.' }}</p>

        <ion-button fill="solid" color="primary" (click)="retry_click()">
          <ion-icon name="refresh-outline" slot="start"></ion-icon>
          Try Again
        </ion-button>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- ================= MAIN CONTENT ================= -->
  <div *ngIf="!viewModel.showSpinner && !isError" class="detail-container">
    <!-- HERO -->
    <div class="hero-section" *ngIf="viewModel.item">
      <div class="item-image-container">
        <img
          [src]="viewModel.item.PictureUrl"
          [alt]="viewModel.item.Title"
          class="item-image"
          (error)="onImageError($event)"
        />

        <div
          class="status-badge"
          [ngClass]="{ 'ended': viewModel.item.HasEnded }"
        >
          <ion-icon
            [name]="viewModel.item.HasEnded ? 'close-circle-outline' : 'time-outline'"
          ></ion-icon>
          <span>
            {{ viewModel.item.HasEnded ? 'Ended' : viewModel.item.CountDownTime
            }}
          </span>
        </div>
      </div>
    </div>

    <!-- DETAILS -->
    <div class="details-section" *ngIf="viewModel.item">
      <ion-card class="detail-card">
        <ion-card-content>
          <h1 class="item-title">{{ viewModel.item.Title }}</h1>

          <div class="price-highlight">
            <span class="price">
              {{ viewModel.item.Currency }}{{ viewModel.item.CurrentPrice |
              number:'1.2-2' }}
            </span>

            <div class="bids">
              <ion-icon name="hammer-outline" color="medium"></ion-icon>
              <span>{{ viewModel.item.Bids }} bids</span>
            </div>
          </div>

          <div class="meta-info">
            <div class="meta-item">
              <ion-icon name="calendar-outline" color="medium"></ion-icon>
              <span>
                Ends: {{ viewModel.item.EndTime | date:"MM/dd/yyyy 'at' h:mma"
                }}
              </span>
            </div>

            <div class="meta-item" *ngIf="viewModel.item.FreeShipping">
              <ion-icon name="car-outline" color="success"></ion-icon>
              <span>Free Shipping</span>
            </div>

            <div class="meta-item" *ngIf="!viewModel.item.Auction">
              <ion-icon name="pricetag-outline" color="warning"></ion-icon>
              <span>Fixed Price</span>
            </div>
          </div>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- ACTIONS -->
    <div class="actions-section" *ngIf="viewModel.item">
      <!-- SNIPE ACTIONS -->
      <ion-card class="actions-card" *ngIf="!viewModel.item.HasEnded">
        <ion-card-content>
          <ion-button
            expand="block"
            *ngIf="!viewModel.itemHasActiveSnipe"
            [disabled]="!viewModel.item.Auction"
            (click)="addToSnipes_click()"
          >
            <ion-icon name="crosshairs-outline" slot="start"></ion-icon>
            Add to Snipes
          </ion-button>

          <ion-button
            expand="block"
            *ngIf="viewModel.itemHasActiveSnipe"
            (click)="updateSnipe_click(viewModel.item.Id)"
          >
            <ion-icon name="create-outline" slot="start"></ion-icon>
            Update Snipe
          </ion-button>

          <ion-button
            expand="block"
            color="danger"
            fill="outline"
            *ngIf="viewModel.itemHasActiveSnipe"
            (click)="removeFromSnipes_click(viewModel.item.Id)"
          >
            <ion-icon name="close-outline" slot="start"></ion-icon>
            Remove Snipe
          </ion-button>
        </ion-card-content>
      </ion-card>

      <!-- WATCH ACTIONS -->
      <ion-card class="actions-card">
        <ion-card-content>
          <ion-button
            expand="block"
            fill="outline"
            *ngIf="!viewModel.itemIsWatched"
            (click)="addToWatches_click(viewModel.item.Id)"
          >
            <ion-icon name="eye-outline" slot="start"></ion-icon>
            Add to Watchlist
          </ion-button>

          <ion-button
            expand="block"
            color="danger"
            fill="outline"
            *ngIf="viewModel.itemIsWatched"
            (click)="removeFromWatches_click(viewModel.item.Id)"
          >
            <ion-icon name="eye-off-outline" slot="start"></ion-icon>
            Remove from Watchlist
          </ion-button>

          <ion-button
            expand="block"
            fill="outline"
            *ngIf="viewModel.itemIsWatched"
            (click)="editWatch_click(viewModel.item.Id)"
          >
            <ion-icon name="create-outline" slot="start"></ion-icon>
            Edit Watch
          </ion-button>
        </ion-card-content>
      </ion-card>

      <!-- VIEW ON EBAY -->
      <ion-card class="actions-card">
        <ion-card-content>
          <ion-button
            expand="block"
            fill="outline"
            (click)="viewOnEbay_click()"
          >
            <ion-icon name="globe-outline" slot="start"></ion-icon>
            View on eBay
          </ion-button>
        </ion-card-content>
      </ion-card>
    </div>
  </div>
</ion-content>
